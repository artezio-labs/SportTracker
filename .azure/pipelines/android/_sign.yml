parameters:
- name: archiveBaseName
  type: string
  default: app-release
- name: archiveType
  type: string
  default: apk
 
steps:

# #####################################################
# Sign Bundle
# #####################################################
- task: AndroidSigning@3
  displayName: 'Sign'
  inputs:
    apksign: true
    zipalign: true
    apkFiles: |
      **/app/build/outputs/**/${{ parameters.archiveBaseName }}*.${{ parameters.archiveType }}
#      $(build.artifactStagingDirectory)/app-release-unsigned.apk
#      $(build.artifactStagingDirectory)/**/*.aab
    apksignerKeystoreFile: GooglePlay_SigningCert_com.artezio.osport.tracker
    apksignerKeystorePassword: $(SigningCert.KeystorePassword)
    apksignerKeystoreAlias: $(SigningCert.KeystoreAlias)
    apksignerKeyPassword: $(SigningCert.KeyPassword)
    apksignerArguments: '
      --verbose 
      --min-sdk-version 21 
      --out "$(Build.BinariesDirectory)/com.artezio.osport.tracker.${{ parameters.archiveType }}"
      '

- powershell: Copy-Item "$(Build.BinariesDirectory)/com.artezio.osport.tracker.${{ parameters.archiveType }}" -Destination "$(build.artifactStagingDirectory)/"
  displayName: 'Copy Artifacts'
